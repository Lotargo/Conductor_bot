<div align="center">
  <img src="docs/assets/sentio_logo.svg" alt="Анимированный Логотип Sentio Engine" width="200"/>
  <h1>Sentio Engine</h1>
  <p>Самодостаточный эмоциональный движок для продвинутого ИИ</p>
  <p>
    <img src="https://img.shields.io/badge/Статус%20Проекта-Активный-brightgreen" alt="Статус Проекта: Активный"/>
    <img src="https://img.shields.io/badge/Лицензия-Apache_2.0-blue.svg" alt="Лицензия: Apache 2.0"/>
    <img src="https://img.shields.io/badge/Python-3.12+-3776AB.svg?logo=python&logoColor=white" alt="Версия Python"/>
    <img src="https://img.shields.io/badge/Фреймворк-FastAPI-009688.svg?logo=fastapi" alt="Фреймворк: FastAPI"/>
    <img src="https://img.shields.io/badge/API-Protobuf-blue" alt="API: Protobuf"/>
  </p>
</div>

[Read in English](README.md)

---

## Содержание
- [Почему Sentio Engine?](#почему-sentio-engine)
- [Ключевые особенности](#ключевые-особенности)
- [Архитектура](#архитектура)
- [Реальные сценарии использования](#реальные-сценарии-использования)
- [Установка](#установка)
- [Использование](#использование)
- [Развертывание в Kubernetes](#развертывание-в-kubernetes)
- [План развития (Roadmap)](#план-развития-roadmap)
- [Полная документация](#полная-документация)

## Почему Sentio Engine?

В то время как многие системы ИИ могут обрабатывать язык, лишь немногие способны улавливать его эмоциональный контекст. Sentio Engine устраняет этот пробел, предоставляя **специализированный, Stateful-микросервис для эмоциональной симуляции**.

*   **Больше, чем просто анализ тональности:** Вместо простого однократного анализа тональности, Sentio обеспечивает постоянное эмоциональное состояние, которое развивается со временем, придавая вашему ИИ последовательную личность и память.
*   **Слабосвязанный по своей природе:** Будучи автономным сервисом, он может быть интегрирован в любое приложение ИИ, независимо от основного языка программирования. Он не будет раздувать логику вашего основного приложения.
*   **Высокая производительность:** Созданный с использованием FastAPI и Protobuf, движок рассчитан на обмен данными с низкой задержкой, гарантируя, что он не станет узким местом.
*   **Глубокая кастомизация:** «Личность» ИИ — его базовые настроения, эмоциональные реакции и основные влечения — определяется в простых JSON-файлах, а не в коде.

## Ключевые особенности

- **Эмоциональное ядро с состоянием:** Поддерживает эмоциональное состояние в памяти, которое реагирует на стимулы и естественным образом затухает со временем.
- **Protobuf API:** Использует высокопроизводительный, не зависящий от языка API на основе Protocol Buffers для коммуникации (`POST /stimulus`, `GET /report`).
- **Настраиваемая личность:** Определяйте эмоциональную палитру ИИ, базовые настроения и скорости затухания в простых файлах `.json`.
- **Долгосрочная память:** Записывает значительные эмоциональные события в базу данных SQLite, создавая историю «жизненного опыта» ИИ.
- **Встроенное кеширование Redis:** Использует Redis для кеширования ответов на повторяющиеся стимулы, значительно повышая производительность.
- **Готовность к развертыванию (Docker):** Поставляется с файлом `docker-compose.yml` для мгновенного запуска приложения и его кеша Redis.
- **Современный стек Python:** Создан с использованием Poetry, FastAPI и SQLAlchemy, в соответствии с современными практиками разработки.

## Архитектура

Движок работает как слабосвязанный микросервис, отделяя эмоциональную обработку от основной логики вашего приложения ИИ.

<div align="center">
  <img src="https://raw.githubusercontent.com/Lotargo/Conductor_bot/refs/heads/main/docs/assets/Animated%20Architecture%20Diagram_for_Sentio_Engine_ru.svg" alt="Анимированная диаграмма" width="900"/>
</div>

1.  **LLM-парсер:** Внешний компонент анализирует ввод пользователя и преобразует его в сообщение `Stimulus`.
2.  **API Sentio Engine:** Получает `Stimulus`, передает его в Ядро Движка и сохраняет эмоциональные изменения в базе данных.
3.  **LLM-генератор:** Перед генерацией ответа запрашивает `Report` у движка и внедряет текущее эмоциональное состояние ИИ в свой системный промпт.

## Реальные сценарии использования

#### Сценарий 1: Эмпатичный ИИ-компаньон

ИИ-компаньон может использовать Sentio для развития последовательной личности и эмоциональной памяти.
- **Процесс:** Пользователь говорит ИИ: «Я так счастлив, я получил новую работу!»
- **Выполнение:**
    1.  `LLM-парсер` создает `Stimulus` с высоким уровнем «радости» и «возбуждения».
    2.  `Sentio Engine` обрабатывает это, и его внутреннее состояние становится более радостным.
    3.  Когда пользователь обращается к ИИ на следующий день, `LLM-генератор` получает `Report`, который все еще показывает слегка повышенный уровень радости.
    4.  ИИ может сгенерировать ответ вроде: «Рад снова с тобой общаться! Все еще в восторге от новой работы?»

#### Сценарий 2: Динамичные NPC в видеоигре

Отношение игрового персонажа к игроку может меняться в зависимости от событий в игре.
- **Процесс:** Игрок выполняет квест, который помогает деревне.
- **Выполнение:**
    1.  Игровая система событий отправляет `Stimulus` с «благодарностью» и «доверием» в экземпляр Sentio Engine, привязанный к конкретному NPC.
    2.  Внутреннее состояние NPC обновляется.
    3.  В следующий раз, когда игрок говорит с NPC, система диалогов получает `Report`, указывающий на высокое доверие.
    4.  Диалоги NPC меняются с общих приветствий на теплые и признательные реплики, и он даже может предложить игроку скидку в своем магазине.

## Установка

### С помощью Docker (Рекомендуется)
1.  **Склонируйте репозиторий.**
2.  **Соберите и запустите контейнер:**
    ```bash
    docker compose up --build -d
    ```

### Для локальной разработки
1.  **Установите Poetry.** (См. [официальную документацию](https://python-poetry.org/docs/#installation)).
2.  **Перейдите в директорию проекта:** `cd sentio_engine`
3.  **Установите зависимости:** `poetry install`

## Использование

### Запуск сервиса
*   **С Docker:** Сервис будет доступен по адресу `http://localhost:8000` после выполнения `docker compose up`.
*   **Локально:** Выполните `poetry run uvicorn sentio_engine.api.main:app --reload` из директории `sentio_engine`.

### Запуск тестов
1.  Перейдите в директорию `sentio_engine`.
2.  Выполните `poetry run pytest`.

## Развертывание в Kubernetes

Базовые манифесты для развертывания приложения в кластере Kubernetes находятся в директории `/k8s`.

**Требования:**
*   Работающий кластер Kubernetes.
*   `kubectl`, настроенный для подключения к вашему кластеру.
*   Docker-образ приложения, загруженный в реестр контейнеров (container registry).

**Шаги:**

1.  **Обновите путь к образу:** В файле `k8s/deployment.yaml` измените значение поля `image` с `your-docker-registry/sentio-engine:latest` на актуальный путь к вашему опубликованному Docker-образу.

2.  **Примените манифесты:**
    ```bash
    kubectl apply -f k8s/deployment.yaml
    kubectl apply -f k8s/service.yaml
    ```

Это создаст `Deployment`, запускающий приложение, и `Service`, который откроет доступ к нему внутри кластера по адресу `http://sentio-engine-service`.

**Примечание:** Предоставленная конфигурация использует эфемерную базу данных SQLite. Для использования в production следует настроить персистентное хранилище или внешнюю базу данных.

## План развития (Roadmap)

Мы активно работаем над улучшением Sentio Engine. Ключевые функции в нашем плане развития:

- [x] ~~**Интеграция с Redis:** Предложить опциональный бэкенд на Redis для краткосрочной памяти.~~ (Реализовано)
- [x] ~~**Протокол для Агентов:** Реализован эндпоинт (`/process_agent_text`) для надежного обновления состояния от LLM-агентов.~~ (Реализовано)
- [x] ~~**Симуляция Времени:** Эмоции теперь затухают в реальном времени, даже когда сервер неактивен.~~ (Реализовано)
- [x] ~~**Механизм Доминантности:** Противоположные эмоции (согласно модели Плутчика) теперь подавляют друг друга.~~ (Реализовано)
- [x] ~~**Движок Комплексных Состояний:** Система теперь может определять долгосрочные чувства (например, "депрессивное состояние") на основе анализа истории.~~ (Реализовано)
- [ ] **Реализация `drives.json`:** Полная интеграция системы основных влечений для влияния на обработку эмоций.
- [ ] **Реализация `BeliefSystem.json`:** Добавление системы убеждений, чтобы основные ценности могли усиливать или подавлять эмоции.
- [ ] **Панель администратора:** Простой веб-интерфейс для визуализации текущего эмоционального состояния движка в реальном времени.

## Полная документация

Для более глубокого изучения архитектуры, API и конфигурации, пожалуйста, обратитесь к **[полной документации](./docs/ru/01_introduction.md)**.
