<svg width="900" height="400" viewBox="0 0 900 400" xmlns="http://www.w3.org/2000/svg" style="background-color: #1a1a1a; color: #d0d0d0; font-family: 'Segoe UI', sans-serif;">
    <defs>
        <marker id="arrowhead-stimulus" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#E0115F"/>
        </marker>
        <style>
            .box { fill: #2a2a2a; stroke: #8B0000; stroke-width: 1; rx: 5; }
            .actor { font-size: 14px; font-weight: bold; fill: #d0d0d0; }
            .line { stroke: #E0115F; stroke-width: 1.5; marker-end: url(#arrowhead-stimulus); }
            .text { font-size: 12px; fill: #d0d0d0; }
            .stimulus-dot { fill: #E0115F; r: 4; }
            .db-write { fill: #4682B4; r: 3; }
        </style>
    </defs>

    <!-- Title -->
    <text x="450" y="30" text-anchor="middle" class="title" style="font-size: 20px;">Процесс Обработки Stimulus</text>

    <!-- Actors -->
    <text x="100" y="80" text-anchor="middle" class="actor">Клиент</text>
    <line x1="100" y1="90" x2="100" y2="350" stroke="#d0d0d0" stroke-width="1"/>
    
    <text x="450" y="80" text-anchor="middle" class="actor">Sentio Engine (API)</text>
    <line x1="450" y1="90" x2="450" y2="350" stroke="#d0d0d0" stroke-width="1"/>

    <text x="750" y="80" text-anchor="middle" class="actor">База Данных (SQLite)</text>
    <line x1="750" y1="90" x2="750" y2="350" stroke="#d0d0d0" stroke-width="1"/>

    <!-- Flow -->
    <!-- 1. Request -->
    <path d="M 110,120 H 440" class="line"/>
    <text x="275" y="115" text-anchor="middle" class="text">1. POST /stimulus (Protobuf)</text>
    <circle class="stimulus-dot">
        <animateMotion path="M 110,120 H 440" dur="2s" begin="0s" repeatCount="indefinite" />
    </circle>

    <!-- 2. Processing -->
    <g transform="translate(450, 150)">
        <rect x="-100" y="0" width="200" height="60" class="box" fill-opacity="0.5">
            <animate attributeName="fill-opacity" values="0.5; 0.8; 0.5" dur="4s" repeatCount="indefinite" />
        </rect>
        <text x="0" y="25" text-anchor="middle" class="text">2. Десериализация</text>
        <text x="0" y="40" text-anchor="middle" class="text">Обновление состояния в памяти</text>
    </g>

    <!-- 3. DB Write -->
    <path d="M 460,240 H 740" class="line"/>
    <text x="600" y="235" text-anchor="middle" class="text">3. Запись в EmotionalHistory</text>
    <circle class="db-write">
        <animateMotion path="M 460,240 H 740" dur="2s" begin="2s" repeatCount="indefinite" />
    </circle>
    
    <!-- 4. DB Response -->
    <path d="M 740,280 H 460" class="line" stroke-dasharray="5,5"/>
    <text x="600" y="275" text-anchor="middle" class="text">4. Подтверждение</text>
    <circle class="db-write" opacity="0.5">
        <animateMotion path="M 740,280 H 460" dur="2s" begin="2s" repeatCount="indefinite" />
    </circle>

    <!-- 5. Final Response -->
    <path d="M 440,320 H 110" class="line"/>
    <text x="275" y="315" text-anchor="middle" class="text">5. HTTP 204 No Content</text>
    <circle class="stimulus-dot" opacity="0.8">
         <animateMotion path="M 440,320 H 110" dur="2s" begin="0s" repeatCount="indefinite" />
    </circle>
</svg>
