# Модуль Listener

## Обзор

Модуль `Listener` — это абстрактная точка входа в систему Conductor. Его задача — принимать входящие события (например, сообщения) с различных платформ и инициировать рабочий процесс.

Благодаря использованию абстрактного базового класса `AbstractListener`, система может легко расширяться для поддержки новых мессенджеров. На данный момент реализованы два типа слушателей:

1.  **`WebhookListener`**: Для платформ, взаимодействующих через веб-хуки (например, WhatsApp Business API).
2.  **`TelegramListener`**: Для интеграции с ботами Telegram.

## Компоненты

### WebhookListener

Это веб-сервер на основе FastAPI, который прослушивает входящие HTTP-запросы.

**Функциональность:**
-   Принимает POST-запрос на эндпоинт `/webhook`.
-   Извлекает `chat_id` из тела JSON-запроса.
-   Вызывает `trigger_screenshot`, передавая `chat_id` и платформу "whatsapp".

**API Эндпоинт (`POST /webhook`):**
-   **Тело запроса (JSON):** `{"chat_id": "some_unique_chat_id"}`
-   **Пример (cURL):**
    ```bash
    curl -X POST http://localhost:8000/webhook \
    -H "Content-Type: application/json" \
    -d '{"chat_id": "user123_chat456"}'
    ```

### TelegramListener

Этот компонент использует библиотеку `python-telegram-bot` для получения сообщений из Telegram.

**Функциональность:**
-   Подключается к Telegram Bot API в режиме long-polling.
-   При получении нового сообщения извлекает `chat_id`.
-   Вызывает `trigger_screenshot`, передавая `chat_id` и платформу "telegram".

**Настройка:**
-   Для работы этого слушателя необходимо указать валидный токен в переменной `TELEGRAM_BOT_TOKEN` в файле `conductor/config.py`.
-   Слушатель автоматически запускается скриптом `run.py`, если токен предоставлен.