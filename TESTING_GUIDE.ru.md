# Руководство по Тестированию Sentio Engine

В этом руководстве описаны шаги по настройке окружения и запуску тестов для проекта Sentio Engine, с особым акцентом на окружение Windows.

## 1. Настройка Окружения

### 1.1 Установка Python
Убедитесь, что у вас установлен Python версии 3.12 или выше. Вы можете скачать его с [официального сайта Python](https://www.python.org/downloads/).

### 1.2 Установка Poetry (менеджер зависимостей)

Poetry используется для управления зависимостями проекта.

**Для Windows (PowerShell):**
Откройте PowerShell и выполните следующую команду:
```powershell
(Invoke-WebRequest -Uri https://install.python-poetry.org -UseBasicParsing).Content | py -
```

**Для macOS / Linux (bash):**
```bash
curl -sSL https://install.python-poetry.org | python3 -
```
После установки может потребоваться перезапустить терминал или командную строку, чтобы `poetry` стала доступна.

### 1.3 Установка Зависимостей Проекта
1.  Склонируйте репозиторий проекта.
2.  Перейдите в директорию `sentio_engine`:
    ```bash
    cd sentio_engine
    ```
3.  Установите зависимости с помощью Poetry:
    ```bash
    poetry install
    ```

## 2. Запуск Юнит-Тестов

Юнит-тесты проверяют отдельные компоненты приложения в изоляции. Они не требуют запуска Docker или реальной базы данных.

Для запуска юнит-тестов выполните следующую команду из директории `sentio_engine`:
```bash
poetry run pytest
```
Тесты должны пройти успешно, показав, что основная логика движка и API работает корректно.

## 3. Запуск Интеграционного Теста (Вручную)

Интеграционный тест проверяет взаимодействие `sentio-engine` с Redis в реальных условиях. Этот тест требует установленного Docker.

### 3.1 Запуск Сервисов
В корневой директории проекта выполните команду для запуска `sentio-engine` и `redis` через Docker:
```bash
docker compose up --build -d
```
*   **Примечание для Windows/Linux:** Если вы получаете ошибку `permission denied`, вам может потребоваться запускать `docker` с правами администратора (`sudo`) или добавить вашего пользователя в группу `docker`.

### 3.2 Запуск Тестового Скрипта
После того как сервисы запущены, выполните интеграционный тест из директории `sentio_engine`:
```bash
poetry run python tests/integration_test.py
```
Этот скрипт выполнит следующие действия:
1.  Очистит кэш Redis.
2.  Отправит первый запрос к API и замерит время (это будет "промах" кэша).
3.  Отправит второй, идентичный запрос и замерит время (это будет "попадание" в кэш).
4.  Сравнит время и убедится, что второй запрос был значительно быстрее.

### 3.3 Остановка Сервисов
После завершения теста остановите сервисы Docker:
```bash
docker compose down
```
Это завершит работу контейнеров и освободит ресурсы.
