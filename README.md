# Проект "Conductor"

## Описание

"Conductor" — это AI-ассистент для проактивной модерации групповых чатов, разработанный для повышения эффективности коммуникации и ускорения принятия решений.

Система построена на событийно-ориентированной архитектуре, где независимые модули взаимодействуют асинхронно через брокер сообщений. **Ключевая особенность — поддержка нескольких платформ (на данный момент WhatsApp и Telegram) благодаря гибкой архитектуре.**

## Архитектура и структура проекта

Проект разделен на несколько независимых модулей. Для легкого расширения и поддержки новых платформ `Listener` и `Executor` построены на основе абстрактных классов.

-   **/listener**: Принимает входящие события. Содержит:
    -   `WebhookListener`: Веб-сервер на FastAPI для приема Webhook-уведомлений (например, от WhatsApp).
    -   `TelegramListener`: Слушатель для сообщений от Telegram-бота.
-   **/screenshotter**: Модуль, отвечающий за создание "снимков" уведомлений (в текущей версии имитируется) и отправку их в нужную очередь в зависимости от платформы.
-   **/orchestrator**: Ядро системы. Управляет состоянием, запускает таймеры для сбора контекста и формирует задачи для AI. **Работает с несколькими платформами одновременно.**
-   **/decision_engine**: Модуль, который обращается к LLM для принятия решений и передает команду дальше, сохраняя информацию о платформе.
-   **/executor**: "Руки" системы. Выполняет команды, полученные от `decision_engine`, **отправляя ответ в правильный мессенджер (WhatsApp или Telegram).**
-   **/shared**: Общие компоненты, включая абстрактные классы (`abstractions.py`) и "заглушки" (`mocks.py`) для внешних сервисов.
-   **/personas**: Директория для хранения JSON-манифестов, описывающих стили поведения AI-агента.
-   **config.py**: Файл с основными настройками проекта.
-   **run.py**: Скрипт для запуска всех компонентов системы.

## Принцип работы

1.  `Listener` (веб-хук или Telegram-бот) получает уведомление о новом сообщении.
2.  Он вызывает `screenshotter`, который создает "снимок" и отправляет его в соответствующую очередь Kafka, помечая платформу-источник.
3.  `Orchestrator` получает уведомление, запускает таймер и собирает все последующие сообщения в течение заданного времени.
4.  По истечении таймера `orchestrator` формирует задачу (с контекстом, платформой и снимками) и отправляет ее в очередь `decision_requests`.
5.  `decision_engine` получает задачу, обращается к AI для принятия решения и отправляет команду в очередь `execution_actions`.
6.  `executor` получает команду, определяет платформу и выполняет действие (например, отправляет сообщение в нужный чат).

## Запуск и настройка

### Быстрый старт (локальная разработка)

Система использует "заглушки" для внешних сервисов и идеально подходит для быстрой разработки и тестирования.

1.  **Установка зависимостей:**
    ```bash
    pip install -r conductor/requirements.txt
    ```

2.  **Настройка конфигурации (опционально):**
    Откройте файл `conductor/config.py`. Чтобы активировать интеграцию с Telegram, вам необходимо:
    -   Получить токен для вашего Telegram-бота у [@BotFather](https://t.me/BotFather).
    -   Заменить значение-плейсхолдер `YOUR_TELEGRAM_BOT_TOKEN` на ваш реальный токен.
    ```python
    # conductor/config.py
    TELEGRAM_BOT_TOKEN = '123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11' # Пример
    ```

3.  **Запуск системы:**
    ```bash
    python run.py
    ```
    Этот скрипт запустит все компоненты в отдельных потоках. Если токен для Telegram настроен, `TelegramListener` будет запущен автоматически.

### Дальнейшая интеграция

Для получения более подробной информации о каждом модуле и его роли в системе, обратитесь к документации в директории `/docs`.